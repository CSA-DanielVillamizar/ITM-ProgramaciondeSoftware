# Implementación de su aplicación Blazor


Cátedra Programación de Software y Programática - Fundamentos de ASP.NET Core 6 Blazor

**Introducción al módulo**

Hemos terminado con el trabajo en la aplicación real. Acabo de tener una última reunión con Bethany y ella aprobó la solicitud. Creo que es hora de ponerlo en vivo. Entonces, aprendamos en este último módulo cómo podemos implementar nuestra aplicación en Azure. Implementaremos nuestra aplicación en Azure. De hecho, se usaron para nuestra aplicación y Azure App Service, probablemente el servicio más utilizado en Azure. Comenzaré el módulo con una breve descripción general de Azure y Azure App Service. Luego, una vez que sepamos cómo crear uno, moveremos toda nuestra aplicación a ese Azure App Service. ¡Hora de desplegar!

**Descripción de los servicios de aplicaciones de Azure**

Ahora, antes de realizar la implementación, asegurémonos de saber qué es exactamente un Azure App Service. Y antes de que analicemos App Services en Azure, quiero tomarme un momento para hablar sobre el propio Microsoft Azure. Seguro que ya has oído hablar de Azure, o quizás ya hayas trabajado con él en otros proyectos. Azure es, por supuesto, la oferta de Microsoft para servicios de computación en la nube. Azure es gigantesco y ofrece mucho más de lo que se puede cubrir en un solo curso, y mucho menos en un solo módulo. Los servicios ofrecidos en Azure incluyen SaaS, PaaS e IaaS. SaaS significa software como servicio, PaaS significa plataforma como servicio y la I en IaaS significa infraestructura. PaaS es el tipo de servicios que usa con más frecuencia. Incluyen todos los servicios de desarrollo e implementación en Azure, lo que nos permite crear, implementar, y alojar todo tipo de aplicaciones enriquecidas con servicios en Azure. Si bien Azure es la oferta de Microsoft, también se puede usar para alojar una gran variedad de tipos de aplicaciones, incluso escritas en otros lenguajes, como Node, Java o Python. Azure se ejecuta en una red mundial de centros de datos creados y mantenidos por Microsoft. A través del portal de Azure, podemos interactuar con nuestras aplicaciones que se ejecutan en Azure. Es nuestra vista de cabina en todo lo que podemos crear y ejecutar en Azure. Desde el portal, podemos crear nuevos servicios, como bases de datos, servicios web, o podemos monitorear fácilmente los servicios existentes, escalarlos o cambiar su configuración. A través del control de acceso basado en roles, podemos especificar quién puede ver y administrar qué recurso en Azure, y también podemos ver cuánto nos costará mensualmente el conjunto actual de servicios que tenemos en ejecución. La inmensidad de Azure es difícil de comprender y la cantidad de servicios que ofrece Azure es enorme. Los servicios informáticos son probablemente los más utilizados. Nos permiten alojar una aplicación web, una API o un servicio. Estos incluyen servicios de aplicaciones, servicios de contenedores y máquinas virtuales. Usando Identity Services, podemos administrar los usuarios y su acceso a los servicios y la infraestructura. El más utilizado aquí es definitivamente Azure Active Directory. El almacenamiento es otra categoría extensa en la que podemos identificar muchos servicios de uso común. Las cuentas de almacenamiento, probablemente las más conocidas en esta categoría, nos brindan acceso a almacenamiento en la nube escalable de forma masiva que luego se puede replicar en los centros de datos. Los servicios de mensajería se utilizan a menudo para escenarios de integración. Una aplicación puede publicar un mensaje en Azure Service Bus, que luego puede ser consumido por otro servicio. Event Grid es otro servicio muy conocido en esta área. A continuación, los servicios de datos, otra gran categoría de servicios. Esta categoría incluye varios tipos de servicios de base de datos administrados. Azure SQL, la versión en la nube de SQL Server, se usa con mucha frecuencia aquí, pero también Cosmos DB, una base de datos noSQL altamente escalable, y Redis, un servicio de almacenamiento en caché de alto rendimiento, forman parte de esta categoría. La IA es una categoría de servicios en rápido crecimiento, incluidos servicios como Azure Machine Learning. Además, los servicios fáciles de consumir, como Face API, forman parte de esta categoría. No profundizaré más en las muchas otras categorías que no tengo en esta diapositiva. Hay muchos otros recursos disponibles en Pluralsight que profundizan en los muchos aspectos de Azure. Nuestra aplicación que hemos creado para Bethany es bastante simple y la implementaremos en Azure App Service, uno de los servicios más comunes en Azure. App Services nos brinda la capacidad de alojar cualquier tipo de aplicación de forma rápida y sencilla. Nuestra aplicación contiene algunas partes. Por supuesto, la aplicación Blazor WebAssembly, pero también el sitio de alojamiento, que también contiene nuestra API. Mi elección personal para hospedar esto sería Azure App Service. Por lo tanto, nuestra aplicación utiliza la aplicación ASP.NET Core 6 y, por supuesto, es compatible. Pero si lo hubiéramos creado usando Node, PHP o, bueno, sí, muchas otras tecnologías, también habría funcionado bien en un Servicio de aplicaciones. App Services es capaz de ejecutar aplicaciones basadas en muchas pilas de tecnología diferentes. Y cuando implementemos nuestra aplicación inicialmente, probablemente aún no tengamos tantos usuarios, para que podamos empezar poco a poco. Pero cuando se contrata a más y más personal, bueno, las cosas pueden ponerse más ocupadas. En ese caso, seguimos siendo buenos con un servicio de aplicaciones, ya que escalan muy bien, tanto verticalmente, con máquinas más pesadas, como horizontalmente, con más máquinas disponibles para manejar las solicitudes. Además de implementar el código real en un servicio de aplicaciones, también necesitaremos implementar la base de datos activa. Para eso, usamos Azure SQL en esta configuración. Azure SQL nos brinda un SQL Server administrado en la nube. Entonces, nuestra base de datos, con sus tablas, se puede implementar fácilmente en Azure SQL. También es un servicio altamente disponible y escalable, una base de datos de gran rendimiento en caso de necesidad. tanto en vertical, con máquinas más pesadas, como en horizontal, con más máquinas disponibles para atender las solicitudes. Además de implementar el código real en un servicio de aplicaciones, también necesitaremos implementar la base de datos activa. Para eso, usamos Azure SQL en esta configuración. Azure SQL nos brinda un SQL Server administrado en la nube. Entonces, nuestra base de datos, con sus tablas, se puede implementar fácilmente en Azure SQL. También es un servicio altamente disponible y escalable, una base de datos de gran rendimiento en caso de necesidad. tanto en vertical, con máquinas más pesadas, como en horizontal, con más máquinas disponibles para atender las solicitudes. Además de implementar el código real en un servicio de aplicaciones, también necesitaremos implementar la base de datos activa. Para eso, usamos Azure SQL en esta configuración. Azure SQL nos brinda un SQL Server administrado en la nube. Entonces, nuestra base de datos, con sus tablas, se puede implementar fácilmente en Azure SQL. También es un servicio altamente disponible y escalable, una base de datos de gran rendimiento en caso de necesidad. se puede implementar fácilmente en Azure SQL. También es un servicio altamente disponible y escalable, una base de datos de gran rendimiento en caso de necesidad. se puede implementar fácilmente en Azure SQL. También es un servicio altamente disponible y escalable, una base de datos de gran rendimiento en caso de necesidad.

**Demostración: Explorando Azure Portal**

Hagamos una exploración rápida de Azure Portal y los servicios que usaremos para la aplicación implementada. Para acceder a Azure y todos los servicios, vaya a portal.azure.com. Si no tiene una cuenta, también puede crear una cuenta de prueba desde allí. En Azure Portal, podemos ver una lista de todos los recursos que tenemos. Veo una lista de recursos recientes en la página de destino, pero también podemos ver todos los demás recursos que ya haya configurado. Desde aquí también, podemos crear nuevos recursos haciendo clic aquí en este +. Lo haré en un segundo. Uno de los conceptos más importantes dentro de Azure es el grupo de recursos. Un grupo de recursos es útil para agrupar recursos relacionados, por ejemplo, una base de datos y un servicio de aplicaciones que potencian Bethany'sPieShopHRM, como veremos en la próxima demostración. Si hago clic aquí en Grupos de recursos, veré todos los grupos de recursos que ya tengo en esta suscripción. Este es el grupo de recursos de Bethany'sPieShopHRM y contiene algunos recursos, como podemos ver aquí. Contiene una base de datos SQL, un Servicio de aplicaciones, un plan de Servicio de aplicaciones y SQL Server. Oye, ya contiene un servicio de aplicaciones, echemos un vistazo a eso. Un servicio de aplicaciones es realmente una aplicación que ejecutamos en Azure. Entonces, cada aplicación, cada sitio web, digamos, que queremos hospedar, generalmente incluirá un servicio de aplicaciones. Un servicio de aplicaciones está alojado en un plan de servicio de aplicaciones. El Plan de App Service puede verse como el servidor bajo su Plan de App Service, y también es lo que escalará. Si ve que tiene mucho tráfico, puede, por ejemplo, hacer clic aquí en Ampliar el plan de App Service y seleccionar uno más caro, pero también un recurso más poderoso. Ahora tengo este tipo de servidor S1 que respalda mi aplicación, pero puedo, por supuesto, ir mucho más alto si tenemos mucho tráfico en nuestro sitio web. Así que es realmente el Plan de Servicio de Aplicaciones lo que podemos escalar. Entonces, de esta manera, podemos usar Azure Portal para ver los recursos existentes y administrarlos. Como se ha dicho, también podemos, por supuesto, desde Azure Portal, crear nuevos recursos. Comenzaré creando un nuevo grupo de recursos. Al crear un grupo de recursos, necesito darle un nombre. Y llamemos al grupo de Recursos, Bethany'sPieShopHRM. A continuación, también puedo seleccionar la Región. Como vivo en Europa, voy a seleccionar aquí, Europa Occidental. Luego haz clic en Revisar + crear para validar que todo salió correctamente. Y luego hago clic en Crear para crear el grupo de recursos. Ahora con el grupo de recursos creado, Puedo crear un nuevo recurso. En esta descripción general, obtengo una lista de todos los servicios posibles que puedo crear en mi nuevo grupo de recursos. Vamos a crear una nueva aplicación web, así que seleccionaré Web aquí. Y luego vamos a crear un servicio de aplicaciones que se incluya en la categoría de aplicaciones web. Así que puedo hacer clic en Crear aquí y seguir el asistente para crear mi nuevo servicio de aplicaciones. No voy a hacer eso aquí a través del Azure Portal. Voy a crear los recursos de Visual Studio en la próxima demostración. Así que puedo hacer clic en Crear aquí y seguir el asistente para crear mi nuevo servicio de aplicaciones. No voy a hacer eso aquí a través del Azure Portal. Voy a crear los recursos de Visual Studio en la próxima demostración. Así que puedo hacer clic en Crear aquí y seguir el asistente para crear mi nuevo servicio de aplicaciones. No voy a hacer eso aquí a través del Azure Portal. Voy a crear los recursos de Visual Studio en la próxima demostración.

**Implementación de la aplicación en un servicio de aplicaciones de Azure**

Ahora estamos listos para implementar Bethany's Pie Shop HRM en Azure App Service. Aquí está la configuración de nuestra aplicación. Usamos una aplicación de hospedaje ASP.NET Core que requerirá que ASP.NET Core esté disponible en el servidor. En nuestro caso, una aplicación Blazor WebAssembly serán archivos estáticos, pero alojados desde dentro de una aplicación ASP.NET Core y, por lo tanto, servidos como archivos estáticos desde la aplicación de alojamiento. La aplicación de alojamiento también contiene los controles de la API, y esos deben usar nuestra base de datos. Los servicios que se configurarán así en Azure son los siguientes. Tendremos un servicio de aplicaciones de Azure para el alojamiento y una base de datos SQL de Azure como base de datos para nuestros controladores de API. Ahora, dado que usamos Blazor WebAssembly, como se dijo, únicamente para la aplicación Blazor, no hay ningún requisito de .NET en el servidor. Si no utiliza una aplicación ASP.NET Core de alojamiento, podemos usar cualquier servidor que aloje archivos estáticos, que es prácticamente todos los servidores. La aplicación Blazor está alojada para el escenario independiente desde index.html, que también es un archivo estático. En este escenario también, podemos conectarnos también con la API remota, pero eso normalmente vivirá en un dominio diferente. Por lo general, una API requerirá tener CORS habilitado. CORS permite que los clientes y las aplicaciones de otros dominios realicen una solicitud a la API. Si no usa la aplicación de hospedaje ASP.NET Core, la aplicación Blazor a menudo se implementa mediante una aplicación web estática de Azure. Para realizar la implementación real, existen varias opciones. La solución más sencilla es realizar una implementación directamente desde Visual Studio. Al hacer clic derecho en el proyecto en el Explorador de soluciones, podemos publicar directamente la aplicación, y eso es lo que haremos aquí también. Este es un enfoque simple, y tendrá la aplicación en funcionamiento en muy poco tiempo. Sin embargo, en escenarios más grandes en los que puede tener diferentes entornos y diferentes servicios que deben implementarse de una sola vez, a menudo se recomienda utilizar un enfoque de CI/CD, abreviatura de integración e implementación continuas. Para Azure DevOps o GitHub Actions, puede crear un script para realizar la implementación de los diferentes servicios que luego se pueden ejecutar para realizar la implementación. Si bien a menudo es el enfoque recomendado, no lo usaremos aquí ya que nos llevaría demasiado lejos. abreviatura de integración e implementación continuas. Para Azure DevOps o GitHub Actions, puede crear un script para realizar la implementación de los diferentes servicios que luego se pueden ejecutar para realizar la implementación. Si bien a menudo es el enfoque recomendado, no lo usaremos aquí ya que nos llevaría demasiado lejos. abreviatura de integración e implementación continuas. Para Azure DevOps o GitHub Actions, puede crear un script para realizar la implementación de los diferentes servicios que luego se pueden ejecutar para realizar la implementación. Si bien a menudo es el enfoque recomendado, no lo usaremos aquí ya que nos llevaría demasiado lejos.

**Demostración: implementación de la aplicación**

Es hora de hacer el despliegue. Volvamos a Visual Studio. Voy a hacer clic con el botón derecho aquí en el proyecto API, ya que ese será el proyecto que efectivamente queremos poner en un servicio de aplicaciones. Y voy a seleccionar aquí, Publicar. El asistente me guiará a través de la mayor parte del trabajo que debo hacer aquí. Voy a decir aquí que quiero publicar esto en Azure, y quiero publicar esto, en este caso, en Azure App Service en Windows. También podemos alojarlo en Linux, pero vemos que también hay otras opciones disponibles. Pero ahora seleccionemos Azure App Service (Windows). Haga clic en Siguiente. Ahora veo mi suscripción y todos los Azure App Services disponibles. Desde aquí, también puedo crear uno nuevo. Voy a hacer eso aquí. Hago clic en + aquí para crear un nuevo Azure App Service y llego a este otro cuadro de diálogo aquí. Este será el Nombre. Dejaremos eso por ahora. Por supuesto, en una aplicación de la vida real, este debería ser un nombre más legible. También volveré a ver mi suscripción aquí y también puedo seleccionar el grupo de recursos. Quiero poner esto en el grupo de Recursos que creamos anteriormente, entonces BethanysPieShopHRM en Europa Occidental. También podría haber creado un nuevo grupo de recursos desde aquí en Visual Studio. Luego necesito seleccionar dónde quiero alojar esto. Voy a crear un nuevo plan de servicio de aplicaciones. Cuidado. El Plan de alojamiento es realmente el servidor que sustenta su sitio alojado. Asegúrese de eliminar esto después de que haya terminado con esta demostración. El Plan de Alojamiento también recibe un nombre sugerido. Vamos a poner esto en Europa Occidental, y también podemos seleccionar el Tamaño. Voy a seleccionar por ahora un S1. Hay otras opciones disponibles. Cuanto más alto vayas, más pagarás, por supuesto. Hago clic en Aceptar y hago clic en Crear aquí. En este punto, se está creando el servicio de aplicaciones. Y ahí vamos, nuestro servicio de aplicaciones ahora está seleccionado aquí. Haga clic en Siguiente. Si se le pregunta acerca de esta habilitación del consumo de API, simplemente omita este paso y haga clic en Finalizar. Ahora tenemos la descripción general para publicar la aplicación. En este momento, no ha sido publicado. También dice aquí, Listo para publicar. Y antes de presionar el botón Publicar, voy a ver aquí las Dependencias. Visual Studio ha detectado que también se usa una base de datos de SQL Server para mi aplicación, y eso es correcto. Por lo tanto, también debemos asegurarnos de configurar esa dependencia. Primero voy a crear una base de datos Azure SQL. Hago clic aquí en los puntos suspensivos y digo Conectar. Ahora necesito, digamos, resolver mi independencia. Necesito señalar a Visual Studio dónde estará la dependencia. No me conectaré a una base de datos local. Quiero conectarme a una base de datos Azure SQL. Lo selecciono y hago clic en Siguiente. Obtengo una descripción general de todas las bases de datos de SQL Server disponibles, pero quiero crear una nueva. Así que haga clic nuevamente en + aquí para crear una nueva base de datos SQL. Me aseguro de que esté dentro del mismo grupo de recursos. Es una buena práctica colocar todos los recursos relacionados, por supuesto, en el mismo grupo de recursos. Luego se nos pide que seleccionemos el servidor de base de datos. Voy a crear uno nuevo aquí también. Nuevamente, tenga cuidado, ya que esto le costará dinero. El nombre sugerido parece contener un punto, así que lo quitaré. Voy a ingresar el nombre de usuario y la contraseña. Asegúrese de recordar eso, ya que lo necesitaremos muy pronto. Así que ahora hemos agregado el nombre de usuario y la contraseña, y hacemos clic en Aceptar. El servidor de base de datos ahora se ha creado. Ahora podemos hacer clic en Crear aquí de nuevo. Y en este punto, el servidor de la base de datos y la base de datos se están creando en Azure. Después de un tiempo, la base de datos ha sido creada. Eso es lo que necesitábamos. Haga clic en Siguiente. Ahora necesitamos, nuevamente, ingresar nuestro nombre de usuario y contraseña que ingresamos al crear el servidor. Y también aquí podemos ver la cadena de conexión. En función de los valores ingresados, se generará la cadena de conexión y se almacenará en Configuración de la aplicación de Azure. Por ahora, copie esto, ya que también lo necesitaremos en un segundo. Haga clic en Finalizar, y luego la base de datos se configurará correctamente. En este punto, nuestra base de datos está en Azure. De hecho, ya está implementado, pero aún no hay datos. De hecho, tampoco hay tablas de base de datos allí todavía. Creamos aquellos con una migración. Entonces, lo que voy a hacer es ir a mi proyecto API y voy a ir a la configuración de la aplicación. Por ahora, voy a reemplazar la conexión predeterminada aquí con la cadena de conexión que acabo de copiar. Que contiene el nombre del servidor de la base de datos en Azure, así como el nombre de usuario y la contraseña. Con esto agregado, vayamos al Portal Azure. Este es nuestro grupo de recursos que ahora ya contiene algunos recursos, el servidor SQL, la base de datos, así como App Service y el plan de App Service. Por ahora, haga clic en la base de datos SQL. Necesito poder acceder a la base de datos de SQL Server desde mi máquina local, así que iré aquí y haré clic en Establecer servidor de seguridad. Aquí abajo en el fondo, Ahora puedo agregar la dirección IP de mi cliente para poder ejecutar una migración desde Visual Studio, que es lo que haré en solo un segundo. Ahora regrese a Visual Studio, y con esta nueva ConnectionString agregada a mi base de datos de Azure, vaya a la consola del Administrador de paquetes. Allí, asegúrese de tener los proyectos API seleccionados y ahora ejecute la base de datos de actualización. Esto ejecutará las migraciones que creamos anteriormente en la base de datos en Azure. Eso creará un esquema de base de datos y también generará algunos datos. Hora del gran momento. Hagamos clic en Publicar. Ahora tenemos que esperar un par de minutos. Y allá vamos, Bethany's Pie Shop HRM está en vivo. Una cosa a tener en cuenta, publiqué la versión sin Auth0 agregado. Si desea que su autenticación también funcione aquí, asegúrese de actualizar los enlaces en la configuración de Auth0 también.

**Resumen y cierre del curso**

Hemos llegado al final de este último módulo y tenemos una aplicación desplegada. Implementé la aplicación en Azure, la plataforma en la nube de Microsoft. He usado Azure App Service para la aplicación real y una base de datos de Azure SQL para la parte de la base de datos. Y con eso, también hemos llegado al final de este curso. Quiero agradecerles por seguir este curso. Considere calificarlo y publique cualquier pregunta que pueda tener en la página de discusión de este curso. Te deseo buena suerte con la próxima gran cosa que crearás. Gracias por ver. Adiós por ahora.
